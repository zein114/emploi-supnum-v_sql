# ----------------------------------------------------------------------
# | Security & URL Optimization                                        |
# ----------------------------------------------------------------------

# 1. Prevent Directory Indexing
# This prevents users from seeing the list of files in directories like /admin/ or /api/
Options -Indexes

# 2. Block direct access to sensitive file types
# Protects database dumps, configuration files, and documentation
<FilesMatch "\.(sql|json|lock|gitignore|md)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# 3. Rewrite Configuration
RewriteEngine On

# 4. Block access to system folders
# These folders contain sensitive logic that should not be accessed directly
RewriteRule ^(config|includes|modele|vendor)/ - [F,L]

# 5. Protect the /admin/ folder
# Redirecting access to the admin folder itself to the login page.
# Individual pages like admin/dashboard will still work (via the rules below).
RewriteRule ^admin/?$ login [R=301,L]

# 6. Clean URLs: Remove .php extension from browser address bar
# We use THE_REQUEST to only redirect actual browser requests and avoid loops.
# API calls are excluded to ensure POST/PUT/DELETE requests aren't broken by redirects.
RewriteCond %{REQUEST_URI} !/api/ [NC]
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/+(.+)\.php[\s?] [NC]
RewriteRule ^ /%1 [R=301,L]

# 7. Internal Mapping: Map extensionless URLs back to .php files
# If the requested name exists as a .php file, serve it.
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]
